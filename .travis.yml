language: c
dist: trusty

matrix:
  include:
  - env: BASE=ubuntu IMAGE=ubuntu:16.04 CCO=gcc

  - env: BASE=ubuntu IMAGE=ubuntu:16.04 CCO=clang

  - env: BASE=ubuntu IMAGE=ubuntu:16.10 CCO=gcc

before_install:
  - docker pull "$IMAGE"
  - cd ..
  - git clone git://git.sv.gnu.org/autoconf-archive.git autoconf
  - git clone https://github.com/GNOME/glib.git
  - git clone https://github.com/GNOME/gobject-introspection.git

script:
  - mkdir -p gjs/m4
  - cp autoconf/m4/ax_*.m4 gjs/m4/
  - cp gobject-introspection/m4/*.m4 gjs/m4/
  - docker run -v $(pwd):/cwd -v $(pwd)/gjs/continuous-integration/check.sh:/check.sh -e "BASE=$BASE" -e "OS=$IMAGE" -e "CC=$CCO" "$IMAGE" bash -e /check.sh
  
